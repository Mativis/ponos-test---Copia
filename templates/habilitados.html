{% extends "base.html" %}

{% block title %}Habilitados{% endblock %}

{% block content %}
<h1 class="fw-light mb-4">Relatório de Habilitação</h1>

<div class="d-flex justify-content-between align-items-center mb-4">
    <a href="#" class="btn btn-info" onclick="window.print()"><i class="fas fa-print me-2"></i>Imprimir Relatório</a>
</div>

<div class="card mb-4">
    <div class="card-header">Filtros</div>
    <div class="card-body">
        <form method="GET" action="{{ url_for('habilitados') }}">
            <div class="row g-3 align-items-end">
                <div class="col-md-5">
                    <label for="nome" class="form-label">Nome do Colaborador</label>
                    <input type="text" class="form-control" id="nome" name="nome" value="{{ selected_nome or '' }}">
                </div>
                <div class="col-md-5">
                    <label for="matricula" class="form-label">Matrícula</label>
                    <input type="text" class="form-control" id="matricula" name="matricula" value="{{ selected_matricula or '' }}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-2"></i>Filtrar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header bg-success text-white">
        Colaboradores com CNH e Consulta em Dia ({{ habilitados_em_dia|length }})
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Matrícula</th>
                        <th scope="col">Vencimento CNH</th>
                        <th scope="col">Última Consulta</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for colaborador in habilitados_em_dia %}
                    <tr>
                        <td>{{ colaborador.nome }}</td>
                        <td>{{ colaborador.matricula }}</td>
                        <td>{{ colaborador.vencimento_cnh.strftime('%d/%m/%Y') }}</td>
                        <td>{{ colaborador.ultima_consulta.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <a href="{{ url_for('confirmar_consulta_cnh', id=colaborador.id) }}" class="btn btn-sm btn-outline-success" title="Confirmar Consulta" onclick="return confirm('Confirmar que a CNH de {{ colaborador.nome }} foi consultada hoje?')"><i class="fas fa-check"></i></a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">Nenhum colaborador com CNH e consulta em dia.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header bg-danger text-white">
        Colaboradores em Atenção (CNH Vencida ou Consulta Antiga) ({{ cnh_atencao|length }})
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Matrícula</th>
                        <th scope="col">Vencimento CNH</th>
                        <th scope="col">Última Consulta</th>
                        <th scope="col">Status</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for colaborador in cnh_atencao %}
                    <tr>
                        <td>{{ colaborador.nome }}</td>
                        <td>{{ colaborador.matricula }}</td>
                        <td>{{ colaborador.vencimento_cnh.strftime('%d/%m/%Y') if colaborador.vencimento_cnh else 'N/A' }}</td>
                        <td>{{ colaborador.ultima_consulta.strftime('%d/%m/%Y') if colaborador.ultima_consulta else 'N/A' }}</td>
                        <td>
                            {% if not colaborador.vencimento_cnh or colaborador.vencimento_cnh <= now %}
                                <span class="badge bg-danger">CNH Vencida</span>
                            {% elif not colaborador.ultima_consulta or (now - colaborador.ultima_consulta).days > 180 %}
                                <span class="badge bg-warning">Consulta Antiga</span>
                            {% else %}
                                <span class="badge bg-secondary">Outro Motivo</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('confirmar_consulta_cnh', id=colaborador.id) }}" class="btn btn-sm btn-outline-success" title="Confirmar Consulta" onclick="return confirm('Confirmar que a CNH de {{ colaborador.nome }} foi consultada hoje?')"><i class="fas fa-check"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% endblock %}